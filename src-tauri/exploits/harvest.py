import re
import requests
import sys

def get_emails_and_ips(url):
    response = requests.get(url)
    content = response.text
    emails = set(re.findall(r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b', content))
    ip_hosts = set(re.findall(r'(?:[0-9]{1,3}\.){3}[0-9]{1,3}', content))
    return emails, ip_hosts

def harvest_emails_and_ips(domain, output):
    url = f"https://www.google.com/search?q=site%3A{domain}&num=100"

    emails, ip_hosts = get_emails_and_ips(url)

    if len(emails) == 0 and len(ip_hosts) == 0:
        print("No emails or IP hosts found.")

    with open(output, "w") as f:
        for email in emails:
            f.write(email + "\n")
        for ip_host in ip_hosts:
            f.write(ip_host + "\n")

    print(f"Found {len(emails)} emails and {len(ip_hosts)} IP hosts. Saved to {output}")

if __name__ == '__main__':
    if len(sys.argv) != 5:
        print("Usage: python harvest.py -d <domain> -o <output>")
        sys.exit(1)

    if sys.argv[1] == '-d':
        domain = sys.argv[2]
    else:
        print("Invalid option: -d <domain>")
        sys.exit(1)

    if sys.argv[3] == '-o':
        output = sys.argv[4]
    else:
        output = "output.txt"

    harvest_emails_and_ips(domain, output)
