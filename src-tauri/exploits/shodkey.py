import os, sys, getopt
import shodan

parameter_list = sys.argv[1:]
options = "h:k:i:"
long_options = ["Help", "Shodan Key", "IP Address"]

shodan_key = ''
host_ip = ''

try:
    opts, args = getopt.getopt(parameter_list, options, long_options)
except getopt.GetoptError:
    print ("Follow instructions below: ")
    print ('shodkey.py -k <shodan key> <IP address>') 
    sys.exit(2)
for opt, arg in opts:
    if opt == '-h':
        print ('shodkey.py -k <shodan key> <IP address>')  
        sys.exit()
    elif opt in ("-k", "--Key"):
        shodan_key = arg
    elif opt in ("-i", "--IP Address"):
        host_ip = arg

print ('Key: ', shodan_key)
print ('Host IP: ', host_ip)

os.environ["SHODAN_API_KEY"] = shodan_key
api_key = os.environ["SHODAN_API_KEY"]
api = shodan.Shodan(api_key)

try:
    host = api.host(host_ip)

    print("-------------------------------------------------------------------------")
    print("Organisation:", host['org'])
    print("IP Address:", host['ip_str'])
    print("Country Name:", host['country_name'])
    print("Domains:", host['domains'])
    print("Host Name:", host['hostnames'])
    print("Operating System:", host.get('os','n/a'))
    print("-------------------------------------------------------------------------")
    for item in host ['data']:
        print("""
        * Product: {}
        * Port: {}
        * Transport: {}""".format(item.get('product'),item['port'],item['transport']))

    print("\nLast Shodan Scan:", host['last_update'])

except Exception as e:
    print('Error: {}'.format(e))